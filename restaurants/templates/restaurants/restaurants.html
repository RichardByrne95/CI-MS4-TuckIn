{% extends "base.html" %}
{% load static %}
{% load mathfilters %}
{% load restaurants_extra %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'restaurants/css/restaurants.css' %}">
{% endblock %}

{% block extra_title %}
    | Restaurants
{% endblock %}

{% block content %}
    <div class="container-fluid no-gutters">
        <section id="restaurants">
            <div class="row no-gutters justify-content-center">
                <!-- Cuisines Column -->
                <aside class="col-1 no-gutters d-none d-lg-block text-center restaurant-cuisines-col">
                    <h4>Cuisines</h4>
                    <div class="restaurant-cuisine">
                        <a href="{% url 'restaurants' %}">
                            <p class="restuarant-cuisine-name">All</p>
                        </a>
                    </div>
                    <hr class="text-dark mb-4">
                    {% for cuisine in all_cuisines %}
                    <div class="restaurant-cuisine">
                        <a href="{% url 'restaurants' %}?cuisine={{ cuisine.name }}">
                            <i class="{{ cuisine.icon_html }}"></i>
                            <p class="restaurant-cuisine-name">{{ cuisine.name|title }}</p>
                        </a>
                    </div>
                    {% endfor %}
                </aside>
                <!-- Restaurants Column -->
                <div class="col-9 no-gutters" id="restaurants-column">
                    <!-- Restaurants Near You Header -->
                    <div class="row no-gutters">
                        <div class="col-10 no-gutters">
                            <!-- If address has been inputted -->
                            {% if short_maps_address %}
                                <h4 class="d-inline-block nearby-restaurants">
                                    {{ open_restaurants|count }}
                                    <!-- Add cuisine type if refining by cuisine -->
                                    {% if current_cuisine %}
                                        {{ current_cuisine|title }}
                                    {% endif %}
                                    <!-- If there is more than 1 or no restaurants open -->
                                    {% if open_restaurants|count > 1 %}
                                        restaurants 
                                    {% else %} 
                                         restaurant 
                                    {% endif %}
                                    delivering to {{ short_maps_address }}
                                </h4>
                                <p class="ms-3 d-inline text-nowrap change-location"><a href="{% url 'home' %}">change location</a></p>
                            {% else %}
                                <h4 class="d-inline-block nearby-restaurants">
                                    {{ open_restaurants|count }}
                                    {% if open_restaurants|count > 1 and open_restaurants|count != 0 %}
                                        restaurants 
                                    {% else %} 
                                        restaurant 
                                    {% endif %}
                                    delivering in Dublin
                                </h4>
                                <p class="ms-5 d-inline text-nowrap change-location"><a href="{% url 'home' %}">set location</a></p>
                            {% endif %}
                        </div>
                        <div class="col-2 no-gutters">
                            <div class="dropdown d-flex justify-content-end">
                                <a href="#" class="btn btn-secondary dropdown-toggle" id="dropdownMenuLink" data-bs-toggle="dropdown"
                                    type="button" aria-haspopup="true" aria-expanded="false">
                                    Sort{% if refine_text %}: {{ refine_text }}{% endif %}
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuLink">
                                    <li><a class="dropdown-item" href="{% url 'restaurants' %}?sort=rating_high&direction=desc">Highest
                                            Rated</a></li>
                                    <li><a class="dropdown-item" href="{% url 'restaurants' %}?sort=free_delivery&direction=asc">Delivery
                                            Cost</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- Restaurant Cards -->
                    <div class="row restaurant-list d-flex">
                        {% for restaurant in open_restaurants %}
                            <div class="col-12 col-md-6 col-lg-4 no-gutters d-inline-block">
                                <!-- Card -->
                                <div class="card h-100 border-0">
                                    <a href="{% url 'restaurant_menu' restaurant.id %}" class="card-body">
                                        <div class="restaurant-card-cover-image-container">
                                            <!-- Cover Image -->
                                            {% if restaurant.cover_image %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}{{ restaurant.cover_image }}" alt="{{ restaurant.friendly_name }} cover image" class="img-fluid card-image-top restaurant-card-cover-image">
                                                </figure>
                                            {% else %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}noimage.png" alt="{{ restaurant.friendly_name }} cover image" class="img-fluid card-image-top restaurant-card-cover-image">
                                                </figure>
                                            {% endif %}
                                            <!-- Logo -->
                                            {% if restaurant.logo %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}{{ restaurant.logo }}" alt="{{ restaurant.friendly_name }} logo" class="img-fluid restaurant-card-logo">
                                                </figure>
                                            {% else %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}noimage.png" alt="{{ restaurant.friendly_name }} logo" class="img-fluid restaurant-card-logo">
                                                </figure>
                                            {% endif %}
                                        </div>
                                        <!-- Name -->
                                        <p class="card-title">{{ restaurant.friendly_name }}</p>
                                        <!-- Rating -->
                                        {% if restaurant.rating %}
                                            {% include 'restaurants/restaurant_rating.html' %}
                                        {% endif %}
                                        <!-- Delivery Cost -->
                                        {% if restaurant.delivery_cost and restaurant.delivery_cost > 0 %}
                                            <p class="card-text delivery-cost">Delivery: €{{ restaurant.delivery_cost }}</p>
                                        {% else %}
                                            <p class="card-text delivery-cost">Free Delivery</p>
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                        <hr class="text-dark">
                        <!-- Opening Later Dividing Banner -->
                        <div class="row no-gutters">
                            <div class="col-12 no-gutters" id="restaurants-opening-later">
                                <h3 id="restaurants-opening-later-text">{{ closed_restaurants|count }}
                                    {% if closed_restaurants|count != 1 %}
                                        restaurants 
                                    {% else %} 
                                         restaurant 
                                    {% endif %}
                                     opening later
                                </h3>
                            </div>
                        </div>
                        <!-- Closed Restaurant Cards -->
                        {% for restaurant in closed_restaurants %}
                            <div class="col-12 col-md-6 col-lg-4 no-gutters d-inline-block">
                                <!-- Card -->
                                <div class="card h-100 border-0">
                                    <a href="{% url 'restaurant_menu' restaurant.id %}" class="card-body">
                                        <div class="restaurant-card-cover-image-container">
                                            <!-- Cover Image -->
                                            {% if restaurant.cover_image %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}{{ restaurant.cover_image }}" alt="{{ restaurant.friendly_name }} cover image"
                                                        class="img-fluid card-image-top opaque-image-overlay restaurant-card-cover-image">
                                                </figure>
                                            {% else %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}noimage.png" alt="{{ restaurant.friendly_name }} cover image"
                                                        class="img-fluid card-image-top opaque-image-overlay restaurant-card-cover-image">
                                                </figure>
                                            {% endif %}
                                            <!-- Logo -->
                                            {% if restaurant.logo %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}{{ restaurant.logo }}" alt="{{ restaurant.friendly_name }} logo"
                                                        class="img-fluid restaurant-card-logo">
                                                </figure>
                                            {% else %}
                                                <figure>
                                                    <img src="{{ MEDIA_URL }}noimage.png" alt="{{ restaurant.friendly_name }} logo"
                                                        class="img-fluid restaurant-card-logo">
                                                </figure>
                                            {% endif %}
                                        </div>
                                        <!-- Name -->
                                        <p class="card-title">{{ restaurant.friendly_name }}</p>
                                        <!-- Rating -->
                                        {% if restaurant.rating %}
                                            {% include 'restaurants/restaurant_rating.html' %}
                                        {% endif %}
                                        <!-- Delivery Cost -->
                                        {% if restaurant.delivery_cost and restaurant.delivery_cost > 0 %}
                                            <p class="card-text delivery-cost">Delivery: €{{ restaurant.delivery_cost }}</p>
                                        {% else %}
                                            <p class="card-text delivery-cost">Free Delivery</p>
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    </div>
{% endblock %}